import Head from "next/head"
import { fetchGraphQL } from "@/utils/contentful"
import { queries } from '@/utils/query'
import { useState, useEffect } from "react"
import styles from '@/styles/Home.module.css'
import Image from "next/image"
import defaultImg from '@/public/images/default.jpg'

export default function Home() {

  const [thoughts, setThoughts] = useState(null)
  const [ideas, setIdeas] = useState(null)

  useEffect(() => {
    fetchGraphQL(`{ ${queries.thoughts}, ${queries.ideas} }`)
      .then((content) => {
        const data = content.data
        setThoughts(data.blogPostCollection.items)
        setIdeas(data.ideaCollection.items)
      })
    return () => {}
  }, [])

  const cloudTopPositions = [10,20,30,40,50,60,70]

  return (
    <>
    <Head>
        <title>uzomas.garden</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main id='garden'>
        <div id='sky'>
          {
            thoughts && thoughts.map(({slug, title}, index) => 
              <div className={styles.cloud} key={slug} style={{
                  animationDelay: `${index*10}s`,
                  top: `${cloudTopPositions[Math.floor(Math.random()*cloudTopPositions.length)]}px`
                }}>
                <h3 className={styles.title}>{title}</h3>
              </div>
            )
          }
        </div>
        <div id='ground' className={styles.ideas}>
          {
            ideas && ideas.map(({ title, imagesCollection, date }, index) => {
              const image = imagesCollection.items[0]
              return <div key={index} className={styles.idea}>
                <Image 
                  src={ image ? image.url : defaultImg } 
                  alt={ image ? image.fileName : "default image" }
                  width={100} 
                  height={100} 
                />
                <p>{title}</p>
                <small>{date}</small>
              </div>
            })
          }
        </div>
      </main>
    </>
  )
}
